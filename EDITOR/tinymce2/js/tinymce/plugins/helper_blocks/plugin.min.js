function randomize(count=10)
{
    let text = "";
    let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

    for( let i=0; i < count; i++ )
        text += possible.charAt(Math.floor(Math.random() * possible.length));

    return text;
}

tinymce.PluginManager.add('helper_blocks', function(editor, url) {
  editor.ui.registry.addButton('helper_blocks', {
    text: 'Блок',
    icon: false,
    onclick: function() {
      // Open window
      editor.windowManager.open({
        title: 'Добавление блока информации',
        body: [
          {type: 'textbox', name: 'title', label: 'Заголовок'},
          {type: 'textbox', name: 'text', label: 'Текст'},
          {type: 'listbox', 
          name: 'color', 
          text:'Жёлтый', 
          label: 'Цвет',
          'values': [
              {text: 'Жёлтый', value: 'notice warning'},
              {text: 'Зелёный', value: 'notice success'},
              {text: 'Красный', value: 'notice error'},
          ]  
          },
          {type: 'listbox', 
          name: 'hideshow', 
          text:'Не скрывать', 
          label: 'Показывать ли блок',
          'values': [
              {text: 'Не скрывать', value: 'show'},
              {text: 'Скрыть', value: 'hide'},
          ]  
          }
        ],
        onsubmit: function(e) {
            if(e.data.title){
              switch(e.data.hideshow){
                case 'show':
                  editor.insertContent('<div class="'+e.data.color+'"><h4>'+e.data.title+'</h4><p>'+e.data.text+'<p></div><br><br>');
                break
                case 'hide':
                  let divid = randomize(32);
                  editor.insertContent('<a class="button green showHideHelperInfo" style="text-align:center;width:100%" data-show="'+divid+'">'+ e.data.title +'<a><div id="'+divid+'" class="'+e.data.color+' HelperInfoHidden"><h3>'+e.data.title+'</h3><p>'+e.data.text+'</p><br><br></div><br><br>');
                break
                default:

                break
              }
              //editor.insertContent('<div class="'+e.data.color+'" style="border:1px solid black; padding:5px"><h4>'+e.data.title+'</h4><p>'+e.data.text+'<p></div><br>');
            }
          else{
            alert('Название должно быть заполнено!');
          }
        }
      });
    }
  });
});